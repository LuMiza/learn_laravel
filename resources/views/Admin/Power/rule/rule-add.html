<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>{:config('admin_title')}</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="__ALAYUI__/css/layui.css">
    <link rel="stylesheet" href="__ACSS__/main.css">
    <link rel="stylesheet" href="__COMM__/css/select2.min.css">
    <script src="__ALAYUI__/layui.js"></script>
    <script src="__AJS__/base.js"></script>
    <script src="__AJS__/jquery.min.js" charset="utf-8"></script>
    <script src="__COMM__/js/select2.min.js" charset="utf-8"></script>
    <style type="text/css">
        .layui-table >tbody b{
            margin-right:10px;
        }
        .layui-table input[type="text"]{
            width: 200px;
            height:30px;
            border: 1px solid #7E7E7E;
            text-indent: 10px;
        }
        .layui-table select{
            width: 200px;
            height:35px;
        }
        .layui-table .tip{

        }
    </style>
</head>

<body>
<div style="padding:5px 10px;">
    <form id="data-form">
        <table class="layui-table">
            <tbody>
            <tr>
                <td>
                    <b>权限名称</b>
                    <input type="text" name="name">
                    <span class="tip">例如：填写中文</span>
                </td>
            </tr>
            <tr>
                <td>
                    <b>父级权限</b>
                    <select name="parent_id">
                        <option value="">请选择</option>
                        <option value="0">顶级权限</option>
                        {foreach name="rule_pids" item="child_pids"}
                            <option value="{$child_pids.p_id}">
                                {if condition="$child_pids.level neq 0"}
                                    {$child_pids.level|str_repeat='&nbsp;&nbsp;&nbsp;&nbsp;',###}├&nbsp;
                                {/if}
                                {$child_pids.p_name}
                            </option>
                        {/foreach}
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <b>模块名称</b>
                    <input type="text" name="module_name">
                    <span class="tip">目前统一填admin</span>
                </td>
            </tr>
            <tr>
                <td>
                    <b>控制器名</b>
                    <input type="text" name="controller_name">
                    <span class="tip">例如：Admin 填 Admin</span>
                </td>
            </tr>
            <tr>
                <td>
                    <b>方法名称</b>
                    <input type="text" name="action_name">
                </td>
            </tr>
            <tr>
                <td>
                    <b>样式名称</b>
                    <input type="text" name="style_name">
                    <span class="tip">权限图标css样式名，可不填，<a href="http://www.fontawesome.com.cn/faicons/" target="_blank" style="color:red;">查看</a></span>
                </td>
            </tr>
            <tr>
                <td>
                    <button type="button"  class="layui-btn" style="width:20%;" lay-filter="add" lay-submit="">增加</button>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
</div>
<script>
    $('select').select2();
    layui.use(['form','layer'], function(){
        //$ = layui.jquery;
        layer = layui.layer;

        function RuleEvent(){
            this.add = function(){
                $('button[type="button"]').click(function(){
                    $.post('{:url("Power/addRule",array(),true,true)}',$('#data-form').serialize(),function(data,textStatus){
                        if( textStatus == 'success' ){
                            layer.alert(data.msg, { title:"操作提示",icon: data.code,time:1000});
                            if( data.code == "1" ){
                                setTimeout(function(){
                                    var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                                    parent.layer.close(index);
                                },1500);
                            }
                            return;
                        }else{
                            layer.alert('服务器繁忙', { title:"操作提示",icon: 0,time:1000});
                            return;
                        }
                    },'json');
                });
            }
        }
        (new RuleEvent()).add();
    });
</script>
</body>

</html>